В решение to be разбиваем монолит на микросервисы, функционал системы:
Микросервисы:
-Сервис пользователей
    Пользователь -> Дом | many to many
-Сервис отопления
    Дом -> Система отопления one-to-many
    Дом -> Сценарий отопления one-to-many
    Сценарий отопления -> Система отопления one-to-many
-Сервис освещения
    Дом -> Система освещения one-to-many
    Дом -> Сценарий освещения one-to-many
    Сценарий освещения -> Система освещения one-to-many
-Сервис ворот
    Дом -> Система ворот one-to-many
    Дом -> Сценарий ворот one-to-many
    Сценарий ворот -> Система ворот one-to-many
-Сервис видеонаблюдения
    Дом -> Система видеонаблюдения one-to-many
    Дом -> Сценарий видеонаблюдения one-to-many
    Сценарий видеонаблюдения -> Система видеонаблюдения one-to-many
Все обращение пользователя идут через Api Gateway по REST, от фронта. Kafka не используется.
Каждый микросервис имеет свою собственную БД.
Взаимодействия между микросервисами нету. Каждый микросервис имеет свои сценарии,
запуск сценариев микросервиса по расписанию.
Все отношения между домом и датчиком отопления/освещения/ворот/видеонаблюдения one-to-many.
Например в доме может быть датчик освещения в каждой комнате, также может быть камера в каждом помещение.
Добавил телеметрию: Администратор системы создает системные-сценарии в каждой системе, которые сохраняются по времени например:
1. сохранять каждую минуту температуру на устройстве
2. записывать когда включили/выключили свет, если это датчик движение/либо датчик "темноты" для улицы.
Все системные сценарии добавляются в тот же обработчик, и устройства опрашиваются по заданному таймингу.